<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Links Avan√ßado</title>
    
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <style>
        /* CSS B√ÅSICO */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        h1 { color: #667eea; margin-bottom: 30px; text-align: center; font-size: 2.5em; }
        
        /* Formul√°rios e Inputs */
        .add-link-form { background: #f8f9ff; padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 2px solid #667eea; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #333; font-weight: 600; }
        input[type="text"], input[type="url"], textarea, input[type="number"], select, #searchInput { 
            width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; transition: border 0.3s; 
        }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
        textarea { resize: vertical; min-height: 80px; }
        
        /* Bot√µes */
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #95a5a6; color: white; margin-right: 10px; }
        .btn-secondary:hover { background: #7f8c8d; }

        /* Lista de Links */
        .link-item { 
            background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #e0e0e0; transition: all 0.3s; position: relative; 
            cursor: move; /* Indica que o item √© arrast√°vel */
        }
        .link-item:hover { box-shadow: 0 5px 20px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .link-item.favorite { border-color: #ffd700; background: #fffdf0; }
        .link-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; }
        .link-title { color: #667eea; font-size: 1.3em; font-weight: 700; text-decoration: none; flex: 1; word-break: break-word; }
        .link-title:hover { text-decoration: underline; }
        .link-url { color: #999; font-size: 0.9em; word-break: break-all; margin-bottom: 10px; }
        .link-category { background: #ecf0f1; color: #34495e; padding: 3px 8px; border-radius: 5px; font-size: 0.8em; font-weight: 600; margin-left: 10px; }

        /* A√ß√µes e Modal */
        .link-actions { display: flex; gap: 8px; flex-shrink: 0; }
        .icon-btn { background: none; border: none; cursor: pointer; font-size: 20px; padding: 5px; transition: transform 0.2s; }
        .icon-btn:hover { transform: scale(1.2); }
        .favorite-btn { color: #ffd700; }
        .move-btn { color: #667eea; }
        .delete-btn { color: #ff4757; }
        .move-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .move-modal.active { display: flex; }
        .move-modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }

        /* NOVO: Barra de Ferramentas e Filtros */
        .toolbar { 
            display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: space-between; 
            margin-bottom: 20px; padding: 15px; border-radius: 10px; background: #f0f4ff; border: 1px solid #ddd;
        }
        .toolbar-group { display: flex; gap: 10px; align-items: center; }
        .toolbar label { margin: 0; font-weight: 700; color: #333; }
        .utility-box { background: #ecf0f1; padding: 20px; border-radius: 10px; margin-bottom: 30px; border: 1px solid #bdc3c7; }
        #linksList { min-height: 50px; } /* Garante espa√ßo para Drag and Drop */

        /* Responsividade */
        @media (max-width: 600px) {
            .container { padding: 20px; }
            h1 { font-size: 1.8em; }
            .link-header { flex-direction: column; }
            .link-actions { margin-top: 10px; }
            .toolbar { flex-direction: column; align-items: stretch; }
            .toolbar-group { flex-direction: column; align-items: stretch; gap: 5px; }
            .toolbar .btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö Gerenciador de Links Avan√ßado</h1>

        <div class="utility-box">
            <h2 style="margin-bottom: 15px; color: #34495e; font-size: 1.5em;">üíæ Backup de Dados</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                <button class="btn btn-primary" onclick="exportLinks()">Exportar (Download JSON)</button>
                <input type="file" id="importFile" accept=".json" style="width: auto; flex-grow: 1; padding: 5px;" onchange="importLinks()">
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">Importar (Upload JSON)</button>
            </div>
            <p style="margin-top: 10px; font-size: 0.85em; color: #7f8c8d;">Use o backup para salvar e restaurar seus links em outro dispositivo.</p>
        </div>
        
        <div class="add-link-form">
            <h2 style="margin-bottom: 20px; color: #667eea;">‚ûï Adicionar Novo Link</h2>
            <div class="form-group">
                <label for="linkUrl">URL do Link:</label>
                <input type="url" id="linkUrl" placeholder="https://exemplo.com" required>
            </div>
            <div class="form-group">
                <label for="linkTitle">T√≠tulo:</label>
                <input type="text" id="linkTitle" placeholder="T√≠tulo do link" required>
            </div>
            <div class="form-group">
                <label for="linkCategory">Categoria:</label>
                <select id="linkCategory">
                    <option value="Sem Categoria">Sem Categoria</option>
                    <option value="Desenvolvimento">Desenvolvimento</option>
                    <option value="Finan√ßas">Finan√ßas</option>
                    <option value="Utilidades">Utilidades</option>
                    <option value="Pessoal">Pessoal</option>
                    <option value="Outros">Outros</option>
                </select>
            </div>
            <div class="form-group">
                <label for="linkDescription">Descri√ß√£o:</label>
                <textarea id="linkDescription" placeholder="Descri√ß√£o do link"></textarea>
            </div>
            <button class="btn btn-primary" onclick="addLink()">Adicionar Link</button>
        </div>
        
        <div class="add-link-form" style="padding: 15px 25px; margin-bottom: 30px;">
            <h2 style="margin-bottom: 20px; color: #764ba2; font-size: 1.5em;">üîç Filtros e Ordena√ß√£o</h2>
            
            <div class="form-group">
                <label for="searchInput">Pesquisar:</label>
                <input type="text" id="searchInput" oninput="renderLinks()" placeholder="T√≠tulo, URL, descri√ß√£o ou notas...">
            </div>

            <div class="toolbar">
                <div class="toolbar-group">
                    <label for="filterCategory">Filtrar por Categoria:</label>
                    <select id="filterCategory" onchange="renderLinks()">
                        <option value="all">Todas as Categorias</option>
                        </select>
                </div>
                
                <div class="toolbar-group">
                    <button class="btn btn-secondary" onclick="sortLinks('favorite')">‚≠ê Favoritos no Topo</button>
                    <button class="btn btn-secondary" onclick="sortLinks('title')">A-Z / Z-A</button>
                </div>
            </div>
        </div>
        <div id="linksList"></div>
    </div>

    <div class="move-modal" id="moveModal">
        <div class="move-modal-content">
            <h3>Mover Link</h3>
            <div class="move-options">
                <button class="btn btn-primary" onclick="moveToPosition('first')">‚¨ÜÔ∏è Mover para Primeira</button>
                <button class="btn btn-primary" onclick="moveToPosition('last')">‚¨áÔ∏è Mover para √öltima</button>
            </div>
            
            <div class="position-input-group">
                <label for="targetPosition">Mover para a linha (1 - <span id="maxPosition">1</span>):</label>
                <input type="number" id="targetPosition" placeholder="Ex: 5" min="1">
                <button class="btn btn-primary" style="margin-top: 10px;" onclick="moveLinkToSpecificPosition()">Mover para Posi√ß√£o</button>
            </div>

            <button class="btn" style="background: #95a5a6; color: white;" onclick="closeMoveModal()">Cancelar</button>
        </div>
    </div>

    <script>
        const initialLinks = [
            // SEU NOVO LINK ADICIONADO AQUI
            { url: 'https://asl43.github.io/repositorio-/', title: 'REPOSITORIO DE LINKS', description: 'Link do pr√≥prio Gerenciador de Links.', notes: '', favorite: true, category: 'Desenvolvimento' },
            
            // Seus links anteriores
            { url: 'https://github.com/asl43/rifa_solidaria', title: 'Rifa Solid√°ria ‚Äì Castra√ß√£o de C√£es e Gatos', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Futebol', title: 'Futebol', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Alarme', title: 'Alarme', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Sv_diario', title: 'SV Di√°rio', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Registro_SV', title: 'Registro SV', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Link_utilidades', title: 'Link Utilidades', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Futebol1', title: 'Futebol 1', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/SV_relatorio', title: 'SV Relat√≥rio', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Conversortextoavancado', title: 'Conversor Texto Avan√ßado', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/SistemacontroleVTR', title: 'Sistema Controle VTR', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Monitor-investimento-', title: 'Monitor Investimento', description: '', notes: '', favorite: false, category: 'Finan√ßas' },
            { url: 'https://github.com/asl43/Gerenciador-arquivo-', title: 'Gerenciador Arquivo', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/System-de-estudos-', title: 'System de Estudos', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/rifa_beneficente', title: 'Rifa Beneficente', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Bin', title: 'Bin', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Audio', title: 'Audio', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Bing', title: 'Bing', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Encurto', title: 'Encurtador', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Sudoku', title: 'Sudoku', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Gest', title: 'Gest', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Gest-or', title: 'Gestor', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Click', title: 'Click', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Energia-consumo', title: 'Energia Consumo', description: '', notes: '', favorite: false, category: 'Finan√ßas' },
            { url: 'https://github.com/asl43/Gest-sv', title: 'Gest SV', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/aguaia', title: 'Aguaia', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Financy', title: 'Financy', description: '', notes: '', favorite: false, category: 'Finan√ßas' },
            { url: 'https://github.com/asl43/Pet', title: 'Pet', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Gps', title: 'GPS', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/CONVERTMP3', title: 'Converter MP3', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Creacao-vd', title: 'Cria√ß√£o VD', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Anota-es', title: 'Anota√ß√µes', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Calend-rio-e-LEMBRETES-', title: 'Calend√°rio e Lembretes', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/mp43', title: 'MP4', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Edi-o-foto', title: 'Edi√ß√£o Foto', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Recicl', title: 'Reciclagem', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Compara', title: 'Comparador', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Autoagendar', title: 'Auto Agendar', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Imgdesenh', title: 'Img Desenho', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/BLOCO', title: 'Bloco', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/ANALIZADOR', title: 'Analisador', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Analy-tel', title: 'Analy Tel', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Chtbot', title: 'Chatbot', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Chat-pwa', title: 'Chat PWA', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Botcht', title: 'Bot Chat', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Integracbot', title: 'Integra√ß√£o Bot', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/gest-sv2', title: 'Gest SV 2', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/gest-sv3', title: 'Gest SV 3', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/gest-sv4', title: 'Gest SV 4', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/contrutor-de-chatbot-', title: 'Construtor de Chatbot', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Chat_Interno', title: 'Chat Interno', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/SMART-AGENDA', title: 'Smart Agenda', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/SMART-AGENDA-SIMILAR', title: 'Smart Agenda Similar', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Agend', title: 'Agenda', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/empenho-de-J', title: 'Empenho de J', description: '', notes: '', favorite: false, category: 'Finan√ßas' }
        ];

        // --- Vari√°veis Globais ---
        let links = loadLinks(); 
        let currentMoveIndex = null;
        let sortDirection = 1; // 1 para A-Z/Ascendente, -1 para Z-A/Descendente
        
        // --- FUN√á√ïES DE PERSIST√äNCIA (localStorage) ---

        function loadLinks() {
            try {
                const savedLinks = localStorage.getItem('myLinkManagerLinks');
                if (savedLinks) {
                    const parsedLinks = JSON.parse(savedLinks);
                    // Garante que links antigos sem 'category' tenham um valor padr√£o
                    return parsedLinks.map(link => ({ 
                        ...link, 
                        category: link.category || 'Sem Categoria' 
                    }));
                }
                // Adiciona 'category' padr√£o aos links iniciais se n√£o vierem com ela
                return initialLinks.map(link => ({ 
                    ...link, 
                    category: link.category || 'Sem Categoria' 
                }));
            } catch (e) {
                console.error("Erro ao carregar links do localStorage:", e);
                return initialLinks;
            }
        }

        function saveLinks() {
            try {
                localStorage.setItem('myLinkManagerLinks', JSON.stringify(links));
            } catch (e) {
                console.error("Erro ao salvar links no localStorage:", e);
            }
        }

        // --- FUN√á√ïES DE BACKUP (Exportar/Importar) ---

        function exportLinks() {
            const dataStr = JSON.stringify(links, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'links_backup.json';

            let linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function importLinks() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert("Por favor, selecione um arquivo JSON para importar.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedLinks = JSON.parse(e.target.result);
                    if (Array.isArray(importedLinks)) {
                        if (confirm(`Tem certeza que deseja substituir os ${links.length} links atuais por ${importedLinks.length} links importados?`)) {
                            links = importedLinks.map(link => ({ 
                                ...link, 
                                category: link.category || 'Sem Categoria' 
                            }));
                            saveLinks();
                            renderLinks();
                            alert("Importa√ß√£o conclu√≠da com sucesso!");
                        }
                    } else {
                        alert("Formato de arquivo JSON inv√°lido. O arquivo deve conter uma lista (array) de links.");
                    }
                } catch (error) {
                    alert("Erro ao ler o arquivo JSON. Verifique se o formato est√° correto.");
                    console.error("Erro de importa√ß√£o:", error);
                }
            };
            reader.readAsText(file);
        }

        // --- FUN√á√ïES DE RENDERIZA√á√ÉO E FILTRO ---

        function getUniqueCategories() {
            // Obt√©m categorias √∫nicas de todos os links, incluindo novos, e as ordena
            const categories = links.map(link => link.category).filter(Boolean);
            return [...new Set(categories)].sort();
        }

        function populateCategoryFilters() {
            const filterSelect = document.getElementById('filterCategory');
            const uniqueCategories = getUniqueCategories();
            const currentFilter = filterSelect.value;
            
            filterSelect.innerHTML = '<option value="all">Todas as Categorias</option>';
            
            uniqueCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                if (category === currentFilter) {
                    option.selected = true;
                }
                filterSelect.appendChild(option);
            });
        }

        function renderLinks() {
            const linksList = document.getElementById('linksList');
            const searchValue = document.getElementById('searchInput').value.toLowerCase().trim();
            const filterCategory = document.getElementById('filterCategory').value;

            // 1. Filtrar links
            let filteredLinks = links.filter(link => {
                const searchString = `${link.title} ${link.url} ${link.description} ${link.notes}`.toLowerCase();
                const matchesSearch = searchString.includes(searchValue);
                const matchesCategory = filterCategory === 'all' || link.category === filterCategory;
                return matchesSearch && matchesCategory;
            });
            
            // 2. Popular filtros (precisa ser feito antes do render)
            populateCategoryFilters();

            // 3. Estado vazio
            if (filteredLinks.length === 0) {
                linksList.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                        </svg>
                        <h3>${searchValue || filterCategory !== 'all' ? 'Nenhum link encontrado com os filtros atuais' : 'Nenhum link salvo ainda'}</h3>
                        <p>${searchValue || filterCategory !== 'all' ? 'Tente ajustar sua pesquisa ou filtro' : 'Adicione seu primeiro link usando o formul√°rio acima'}</p>
                    </div>
                `;
                return;
            }

            // 4. Renderizar links filtrados
            linksList.innerHTML = filteredLinks.map((link, index) => {
                // Encontrar o √≠ndice original para usar nas fun√ß√µes (delete, move, etc.)
                const originalIndex = links.indexOf(link); 
                const linkNumber = `${originalIndex + 1}. `; 
                
                return `
                    <div class="link-item ${link.favorite ? 'favorite' : ''}" data-id="${originalIndex}">
                        <div class="link-header">
                            ${link.editing ? 
                                `<input type="text" class="title-input" value="${link.title}" onblur="saveTitle(${originalIndex}, this.value)" onkeypress="if(event.key==='Enter') saveTitle(${originalIndex}, this.value)" autofocus>` :
                                `<a href="${link.url}" target="_blank" class="link-title">${linkNumber}${link.title} 
                                    <span class="link-category">${link.category}</span>
                                </a>`
                            }
                            <div class="link-actions">
                                <button class="icon-btn edit-btn" onclick="toggleEditTitle(${originalIndex})" title="${link.editing ? 'Salvar' : 'Editar T√≠tulo'}">
                                    ${link.editing ? '‚úì' : '‚úèÔ∏è'}
                                </button>
                                <button class="icon-btn favorite-btn" onclick="toggleFavorite(${originalIndex})" title="Favoritar">
                                    ${link.favorite ? '‚≠ê' : '‚òÜ'}
                                </button>
                                <button class="icon-btn move-btn" onclick="openMoveModal(${originalIndex})" title="Mover">
                                    ‚ÜïÔ∏è
                                </button>
                                <button class="icon-btn delete-btn" onclick="deleteLink(${originalIndex})" title="Excluir">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                        <div class="link-url">${link.url}</div>
                        <div class="link-description">${link.description || 'Sem descri√ß√£o'}</div>
                        <textarea class="link-notes" placeholder="Adicione notas aqui..." oninput="updateNotes(${originalIndex}, this.value)">${link.notes || ''}</textarea>
                    </div>
                `;
            }).join('');
            
            // 5. Reiniciar o Drag and Drop
            initializeSortable();
        }

        // --- FUN√á√ïES DE ORDENA√á√ÉO (Sort) ---

        function sortLinks(type) {
            if (type === 'title') {
                // Alterna a dire√ß√£o (A-Z ou Z-A)
                sortDirection = sortDirection * -1; 
                links.sort((a, b) => a.title.localeCompare(b.title) * sortDirection);
            } else if (type === 'favorite') {
                // Ordena favoritos primeiro 
                links.sort((a, b) => {
                    if (a.favorite && !b.favorite) return -1;
                    if (!a.favorite && b.favorite) return 1;
                    return 0; 
                });
            }
            saveLinks();
            renderLinks();
        }

        // --- FUN√á√ïES DE DRAG AND DROP (Sortable.js) ---

        function initializeSortable() {
            const list = document.getElementById('linksList');
            // S√≥ permite o Drag and Drop se n√£o houver filtro ou pesquisa ativa
            const isFiltered = document.getElementById('searchInput').value.trim() !== '' || document.getElementById('filterCategory').value !== 'all';

            if (list.sortable) {
                list.sortable.destroy();
            }

            if (isFiltered) {
                list.style.cursor = 'default';
                return; // N√£o inicializa o Sortable
            }
            
            list.style.cursor = 'move';
            list.sortable = Sortable.create(list, {
                animation: 150,
                filter: '.title-input, .link-notes',
                onEnd: function (evt) {
                    const oldIndex = evt.oldIndex;
                    const newIndex = evt.newIndex;
                    
                    // O Sortable.js move os elementos visuais. Agora atualizamos o array links.
                    const itemToMove = links.splice(oldIndex, 1)[0];
                    links.splice(newIndex, 0, itemToMove);
                    
                    saveLinks();
                    renderLinks();
                },
            });
        }

        // --- FUN√á√ïES DE CRUD E MOVIMENTA√á√ÉO ---

        function addLink() {
            const url = document.getElementById('linkUrl').value.trim();
            const title = document.getElementById('linkTitle').value.trim();
            const description = document.getElementById('linkDescription').value.trim();
            const category = document.getElementById('linkCategory').value;

            if (!url || !title) {
                alert('Por favor, preencha a URL e o t√≠tulo do link!');
                return;
            }

            links.push({
                url: url,
                title: title,
                description: description,
                notes: '',
                favorite: false,
                category: category 
            });

            document.getElementById('linkUrl').value = '';
            document.getElementById('linkTitle').value = '';
            document.getElementById('linkDescription').value = '';
            document.getElementById('linkCategory').value = 'Sem Categoria';

            saveLinks();
            renderLinks();
        }

        function toggleFavorite(index) {
            links[index].favorite = !links[index].favorite;
            saveLinks();
            renderLinks();
        }

        function toggleEditTitle(index) {
            links.forEach((link, i) => {
                if (i !== index) link.editing = false;
            });
            links[index].editing = !links[index].editing;
            renderLinks();
        }

        function saveTitle(index, newTitle) {
            if (newTitle.trim()) {
                links[index].title = newTitle.trim();
                links[index].editing = false;
                saveLinks();
                renderLinks();
            }
        }

        function updateNotes(index, value) {
            links[index].notes = value;
            saveLinks();
        }

        function deleteLink(index) {
            if (confirm('Tem certeza que deseja excluir este link?')) {
                links.splice(index, 1);
                saveLinks();
                renderLinks();
            }
        }

        function openMoveModal(index) {
            currentMoveIndex = index;
            document.getElementById('maxPosition').textContent = links.length;
            document.getElementById('targetPosition').setAttribute('max', links.length);
            document.getElementById('targetPosition').value = index + 1;
            document.getElementById('moveModal').classList.add('active');
        }

        function closeMoveModal() {
            document.getElementById('moveModal').classList.remove('active');
            currentMoveIndex = null;
        }

        function moveToPosition(position) {
            if (currentMoveIndex === null) return;

            const link = links.splice(currentMoveIndex, 1)[0];
            
            if (position === 'first') {
                links.unshift(link);
            } else if (position === 'last') {
                links.push(link);
            }

            saveLinks();
            renderLinks();
            closeMoveModal();
        }

        function moveLinkToSpecificPosition() {
            if (currentMoveIndex === null) return;
            
            const targetPositionInput = document.getElementById('targetPosition');
            let targetPosition = parseInt(targetPositionInput.value); 
            let targetIndex = targetPosition - 1; 
            
            if (isNaN(targetPosition) || targetPosition < 1 || targetPosition > links.length) {
                alert(`Por favor, insira uma linha v√°lida entre 1 e ${links.length}.`);
                return;
            }

            const link = links.splice(currentMoveIndex, 1)[0];
            links.splice(targetIndex, 0, link);

            saveLinks();
            renderLinks();
            closeMoveModal();
        }

        // Inicializar a aplica√ß√£o
        renderLinks();
    </script>
</body>
</html>
