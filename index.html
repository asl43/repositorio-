<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Links ULTRA</title>
    
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <style>
        /* BASE CSS */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; transition: background 0.3s ease; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); transition: background 0.3s ease, box-shadow 0.3s ease; }
        h1, h2 { color: #667eea; margin-bottom: 30px; text-align: center; font-size: 2.5em; transition: color 0.3s ease; }
        h2 { font-size: 1.5em; text-align: left; }
        
        /* DARK MODE STYLES */
        body.dark-mode { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #e0e0e0; }
        body.dark-mode .container { background: #222a3d; box-shadow: 0 20px 60px rgba(0,0,0,0.6); }
        body.dark-mode h1, body.dark-mode h2 { color: #9ab4f3; }
        body.dark-mode .add-link-form { background: #2f3b52; border-color: #9ab4f3; }
        body.dark-mode .form-group label { color: #ccc; }
        body.dark-mode input, body.dark-mode textarea, body.dark-mode select { background: #3c4a63; border-color: #5568d3; color: #e0e0e0; }
        body.dark-mode input:focus, body.dark-mode textarea:focus, body.dark-mode select:focus { border-color: #9ab4f3; }
        body.dark-mode .btn-primary { background: #9ab4f3; color: #222a3d; }
        body.dark-mode .btn-primary:hover { background: #7c9ded; }
        body.dark-mode .btn-secondary { background: #5a6a7c; color: #e0e0e0; }
        body.dark-mode .btn-secondary:hover { background: #6d7e8f; }
        body.dark-mode .link-item { background: #2f3b52; border-color: #3c4a63; }
        body.dark-mode .link-item.favorite { border-color: #ffd700; background: #3e4b67; }
        body.dark-mode .link-item:hover { box-shadow: 0 5px 20px rgba(0,0,0,0.4); }
        body.dark-mode .link-title { color: #9ab4f3; }
        body.dark-mode .link-url { color: #aaa; }
        body.dark-mode .link-description, body.dark-mode .description-text { color: #ccc; }
        body.dark-mode .link-category { background: #5568d3; color: #e0e0e0; }
        body.dark-mode .link-notes { background: #3c4a63; border-color: #5568d3; color: #e0e0e0; }
        body.dark-mode .empty-state h3, body.dark-mode .empty-state p { color: #999; }
        body.dark-mode .move-modal-content, body.dark-mode .category-modal-content, body.dark-mode .edit-modal-content { background: #2f3b52; }
        body.dark-mode .move-modal h3, body.dark-mode .category-modal-content h3, body.dark-mode .edit-modal-content h3 { color: #9ab4f3; }
        body.dark-mode .toolbar { background: #2f3b52; border-color: #3c4a63; }
        body.dark-mode .toolbar label { color: #ccc; }
        body.dark-mode .utility-box { background: #2f3b52; border-color: #3c4a63; }
        body.dark-mode .utility-box h2 { color: #9ab4f3; }
        body.dark-mode .utility-box p { color: #aaa; }
        body.dark-mode .icon-btn { color: #ccc; } 
        body.dark-mode .edit-btn { color: #2ecc71; }
        body.dark-mode .favorite-btn { color: #ffd700; }
        body.dark-mode .move-btn { color: #9ab4f3; }
        body.dark-mode .delete-btn { color: #ff4757; }
        body.dark-mode .category-item { background: #3c4a63; border-color: #5568d3; }

        /* General Styling */
        .add-link-form { background: #f8f9ff; padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 2px solid #667eea; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #333; font-weight: 600; }
        input[type="text"], input[type="url"], textarea, input[type="number"], select, #searchInput { 
            width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; transition: border 0.3s; 
        }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
        textarea { resize: vertical; min-height: 80px; }
        
        /* Buttons */
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #95a5a6; color: white; margin-right: 10px; }
        .btn-secondary:hover { background: #7f8c8d; }

        /* Link Items */
        .link-item { 
            background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #e0e0e0; transition: all 0.3s; position: relative; 
            cursor: grab;
        }
        
        /* Actions and Modal */
        .link-actions { display: flex; gap: 8px; flex-shrink: 0; margin-left: auto; }
        .icon-btn { background: none; border: none; cursor: pointer; font-size: 20px; padding: 5px; transition: transform 0.2s; color: #666; }
        .icon-btn:hover { transform: scale(1.2); }
        
        /* Modal Base Style */
        .move-modal, .category-modal, .edit-link-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .move-modal.active, .category-modal.active, .edit-link-modal.active { display: flex; }
        .move-modal-content, .category-modal-content, .edit-modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }

        /* CATEGORY MANAGEMENT STYLES */
        .category-management { margin-top: 20px; }
        .category-list { max-height: 300px; overflow-y: auto; padding-right: 10px; margin-bottom: 20px; }
        .category-item { 
            display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; 
            border: 1px solid #ddd; border-radius: 8px; margin-bottom: 8px; background: #f9f9f9;
        }
        .category-item input[type="text"] {
            flex: 1; margin-right: 10px; padding: 5px; border: 1px solid #ccc; font-weight: 600;
        }

        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Responsiveness */
        @media (max-width: 600px) {
            .container { padding: 20px; }
            .link-actions { margin-top: 10px; justify-content: flex-end; }
            .toolbar { flex-direction: column; align-items: stretch; }
            .toolbar-group { flex-direction: column; align-items: stretch; gap: 5px; }
            .toolbar .btn { width: 100%; }
            .dark-mode-toggle { top: 10px; right: 10px; width: 35px; height: 35px; font-size: 1em; }
        }
    </style>
</head>
<body>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Alternar Tema">üåô</button>

    <div class="container">
        <h1>üìö Gerenciador de Links ULTRA</h1>

        <div class="utility-box">
            <h2 style="margin-bottom: 15px;">üõ†Ô∏è Ferramentas</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                <button class="btn btn-primary" onclick="exportLinks()">Exportar (Download JSON)</button>
                <input type="file" id="importFile" accept=".json" style="width: auto; flex-grow: 1; padding: 5px;" onchange="importLinks()">
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">Importar (Upload JSON)</button>
            </div>
            <p style="margin-top: 10px; font-size: 0.85em; color: #7f8c8d;">Use o backup para salvar e restaurar seus links. Clique em **Gerenciar Categorias** abaixo para organizar seus dados.</p>
        </div>
        
        <div class="add-link-form">
            <h2 style="margin-bottom: 20px;">‚ûï Adicionar Novo Link</h2>
            <div class="form-group">
                <label for="linkUrl">URL do Link:</label>
                <input type="text" id="linkUrl" placeholder="https://exemplo.com ou apenas exemplo.com" required>
            </div>
            <div class="form-group">
                <label for="linkTitle">T√≠tulo:</label>
                <input type="text" id="linkTitle" placeholder="T√≠tulo do link" required>
            </div>
            <div class="form-group">
                <label for="linkCategory">Categoria:</label>
                <select id="linkCategory"></select>
            </div>
            <div class="form-group">
                <label for="linkDescription">Descri√ß√£o:</label>
                <textarea id="linkDescription" placeholder="Descri√ß√£o do link"></textarea>
            </div>
            <button class="btn btn-primary" onclick="addLink()">Adicionar Link</button>
        </div>
        
        <div class="add-link-form" style="padding: 15px 25px; margin-bottom: 30px;">
            <h2 style="margin-bottom: 20px;">üîç Filtros e Ordena√ß√£o</h2>
            
            <div class="form-group">
                <label for="searchInput">Pesquisar:</label>
                <input type="text" id="searchInput" oninput="renderLinks()" placeholder="T√≠tulo, URL, descri√ß√£o ou notas...">
            </div>

            <div class="toolbar">
                <div class="toolbar-group">
                    <label for="filterCategory">Filtrar por Categoria:</label>
                    <select id="filterCategory" onchange="renderLinks()"></select>
                </div>
                
                <div class="toolbar-group">
                    <button class="btn btn-secondary" onclick="openCategoryModal()">‚öôÔ∏è Gerenciar Categorias</button>
                    <button class="btn btn-secondary" onclick="sortLinks('favorite')">‚≠ê Favoritos no Topo</button>
                    <button class="btn btn-secondary" onclick="sortLinks('title')">A-Z / Z-A</button>
                </div>
            </div>
        </div>
        <div id="linksList"></div>
    </div>

    <div class="move-modal" id="moveModal">
        <div class="move-modal-content">
            <h3>Mover Link</h3>
            <div class="move-options">
                <button class="btn btn-primary" onclick="moveToPosition('first')">‚¨ÜÔ∏è Mover para Primeira</button>
                <button class="btn btn-primary" onclick="moveToPosition('last')">‚¨áÔ∏è Mover para √öltima</button>
            </div>
            
            <div class="position-input-group">
                <label for="targetPosition">Mover para a linha (1 - <span id="maxPosition">1</span>):</label>
                <input type="number" id="targetPosition" placeholder="Ex: 5" min="1">
                <button class="btn btn-primary" style="margin-top: 10px;" onclick="moveLinkToSpecificPosition()">Mover para Posi√ß√£o</button>
            </div>

            <button class="btn" style="background: #95a5a6; color: white; margin-top: 20px;" onclick="closeMoveModal()">Cancelar</button>
        </div>
    </div>

    <div class="category-modal" id="categoryModal">
        <div class="category-modal-content">
            <h3>‚öôÔ∏è Gerenciar Categorias</h3>
            
            <div class="category-add" style="display: flex; gap: 10px; margin-bottom: 15px;">
                <input type="text" id="newCategoryName" placeholder="Novo nome de categoria" style="flex: 1;">
                <button class="btn btn-primary" onclick="addCategory()">Adicionar</button>
            </div>

            <div class="category-management">
                <h4>Categorias Atuais:</h4>
                <div class="category-list" id="categoryList">
                    </div>
                <p style="font-size: 0.8em; color: #7f8c8d;">**Nota:** "Sem Categoria" n√£o pode ser alterada ou exclu√≠da.</p>
            </div>

            <button class="btn" style="background: #95a5a6; color: white; margin-top: 20px;" onclick="closeCategoryModal()">Fechar</button>
        </div>
    </div>

    <div class="edit-link-modal" id="editLinkModal">
        <div class="edit-modal-content">
            <h3>‚úçÔ∏è Editar Link</h3>
            <input type="hidden" id="editLinkIndex">
            
            <div class="form-group">
                <label for="editLinkUrl">URL do Link:</label>
                <input type="text" id="editLinkUrl" required>
            </div>
            <div class="form-group">
                <label for="editLinkTitle">T√≠tulo:</label>
                <input type="text" id="editLinkTitle" required>
            </div>
            <div class="form-group">
                <label for="editLinkCategory">Categoria:</label>
                <select id="editLinkCategory"></select>
            </div>
            <div class="form-group">
                <label for="editLinkDescription">Descri√ß√£o:</label>
                <textarea id="editLinkDescription"></textarea>
            </div>

            <button class="btn btn-primary" onclick="saveEditedLink()">Salvar Altera√ß√µes</button>
            <button class="btn" style="background: #95a5a6; color: white; margin-top: 10px;" onclick="closeEditModal()">Cancelar</button>
        </div>
    </div>


    <script>
        // --- Dados Iniciais (Apenas para primeira carga) ---
        const initialLinks = [
            { url: 'https://asl43.github.io/repositorio-/', title: 'REPOSITORIO DE LINKS', description: 'Link do pr√≥prio Gerenciador de Links.', notes: '', favorite: true, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/rifa_solidaria', title: 'Rifa Solid√°ria ‚Äì Castra√ß√£o de C√£es e Gatos', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Futebol', title: 'Futebol', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Alarme', title: 'Alarme', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Sv_diario', title: 'SV Di√°rio', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Registro_SV', title: 'Registro SV', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Link_utilidades', title: 'Link Utilidades', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Futebol1', title: 'Futebol 1', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/SV_relatorio', title: 'SV Relat√≥rio', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Conversortextoavancado', title: 'Conversor Texto Avan√ßado', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/SistemacontroleVTR', title: 'Sistema Controle VTR', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Monitor-investimento-', title: 'Monitor Investimento', description: '', notes: '', favorite: false, category: 'Finan√ßas' },
            { url: 'https://github.com/asl43/Gerenciador-arquivo-', title: 'Gerenciador Arquivo', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/System-de-estudos-', title: 'System de Estudos', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/rifa_beneficente', title: 'Rifa Beneficente', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Bin', title: 'Bin', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Audio', title: 'Audio', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Bing', title: 'Bing', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Encurto', title: 'Encurtador', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Sudoku', title: 'Sudoku', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Gest', title: 'Gest', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Gest-or', title: 'Gestor', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Click', title: 'Click', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Energia-consumo', title: 'Energia Consumo', description: '', notes: '', favorite: false, category: 'Finan√ßas' },
            { url: 'https://github.com/asl43/Gest-sv', title: 'Gest SV', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/aguaia', title: 'Aguaia', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Financy', title: 'Financy', description: '', notes: '', favorite: false, category: 'Finan√ßas' },
            { url: 'https://github.com/asl43/Pet', title: 'Pet', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Gps', title: 'GPS', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/CONVERTMP3', title: 'Converter MP3', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Creacao-vd', title: 'Cria√ß√£o VD', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Anota-es', title: 'Anota√ß√µes', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Calend-rio-e-LEMBRETES-', title: 'Calend√°rio e Lembretes', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/mp43', title: 'MP4', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Edi-o-foto', title: 'Edi√ß√£o Foto', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Recicl', title: 'Reciclagem', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/Compara', title: 'Comparador', description: '', notes: '', favorite: false, category: 'Utilidades' },
            { url: 'https://github.com/asl43/Autoagendar', title: 'Auto Agendar', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Imgdesenh', title: 'Img Desenho', description: '', notes: '', favorite: false, category: 'Outros' },
            { url: 'https://github.com/asl43/BLOCO', title: 'Bloco', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/ANALIZADOR', title: 'Analisador', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Analy-tel', title: 'Analy Tel', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Chtbot', title: 'Chatbot', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Chat-pwa', title: 'Chat PWA', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Botcht', title: 'Bot Chat', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Integracbot', title: 'Integra√ß√£o Bot', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/gest-sv2', title: 'Gest SV 2', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/gest-sv3', title: 'Gest SV 3', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/gest-sv4', title: 'Gest SV 4', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/contrutor-de-chatbot-', title: 'Construtor de Chatbot', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/Chat_Interno', title: 'Chat Interno', description: '', notes: '', favorite: false, category: 'Desenvolvimento' },
            { url: 'https://github.com/asl43/SMART-AGENDA', title: 'Smart Agenda', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/SMART-AGENDA-SIMILAR', title: 'Smart Agenda Similar', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/Agend', title: 'Agenda', description: '', notes: '', favorite: false, category: 'Pessoal' },
            { url: 'https://github.com/asl43/empenho-de-J', title: 'Empenho de J', description: '', notes: '', favorite: false, category: 'Finan√ßas' }
        ];

        // --- Vari√°veis Globais ---
        let links = loadLinks(); 
        let currentMoveIndex = null;
        let sortDirection = 1; 
        
        // --- FUN√á√ïES DE DARK MODE ---
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            updateDarkModeToggleIcon();
        }

        function loadDarkModePreference() {
            const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
            const savedPreference = localStorage.getItem('darkMode');

            if (savedPreference === 'true' || (savedPreference === null && prefersDarkScheme.matches)) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            updateDarkModeToggleIcon();
        }

        function updateDarkModeToggleIcon() {
            const toggleButton = document.querySelector('.dark-mode-toggle');
            if (toggleButton) {
                toggleButton.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
            }
        }
        
        // --- FUN√á√ïES DE PERSIST√äNCIA (localStorage) ---

        function loadLinks() {
            try {
                const savedLinks = localStorage.getItem('myLinkManagerLinks');
                if (savedLinks) {
                    const parsedLinks = JSON.parse(savedLinks);
                    return parsedLinks.map(link => ({ 
                        ...link, 
                        category: link.category || 'Sem Categoria',
                        editingTitle: false,
                        editingDescription: false,
                        editingCategory: false
                    }));
                }
                return initialLinks.map(link => ({ 
                    ...link, 
                    category: link.category || 'Sem Categoria',
                    editingTitle: false,
                    editingDescription: false,
                    editingCategory: false
                }));
            } catch (e) {
                console.error("Erro ao carregar links do localStorage:", e);
                return initialLinks;
            }
        }

        function saveLinks() {
            try {
                const linksToSave = links.map(link => {
                    // Remove flags de edi√ß√£o antes de salvar
                    const { editingTitle, editingDescription, editingCategory, ...rest } = link;
                    return rest;
                });
                localStorage.setItem('myLinkManagerLinks', JSON.stringify(linksToSave));
                updatePageTitleCount(); 
            } catch (e) {
                console.error("Erro ao salvar links no localStorage:", e);
            }
        }

        // --- FUN√á√ÉO DE CONTAGEM NO T√çTULO DA P√ÅGINA ---
        function updatePageTitleCount() {
            const totalCount = links.length;
            document.title = `Gerenciador de Links ULTRA (${totalCount})`;
        }


        // --- FUN√á√ïES DE CATEGORIAS ---
        function getUniqueCategories() {
            const categories = links.map(link => link.category).filter(Boolean);
            const uniqueCategories = [...new Set(categories)];
            
            const defaultCategory = 'Sem Categoria';
            const sorted = uniqueCategories
                .filter(cat => cat !== defaultCategory)
                .sort((a, b) => a.localeCompare(b));

            return [defaultCategory, ...sorted];
        }

        function getUniqueCategoriesWithCount() {
            const categoryCounts = {};
            links.forEach(link => {
                const category = link.category || 'Sem Categoria';
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            });
            
            const uniqueCategories = getUniqueCategories(); 
            
            return uniqueCategories.map(category => ({
                name: category,
                count: categoryCounts[category] || 0
            }));
        }

        function populateCategorySelects(targetSelectId = null, selectedCategory = null) {
            const uniqueCategories = getUniqueCategories();
            const addSelect = document.getElementById('linkCategory');
            const filterSelect = document.getElementById('filterCategory');
            
            // Popula o select de Adi√ß√£o
            addSelect.innerHTML = uniqueCategories.map(cat => 
                `<option value="${cat}">${cat}</option>`
            ).join('');
            
            // Popula o select de Edi√ß√£o (se estiver ativo)
            if (targetSelectId === 'editLinkCategory') {
                const editSelect = document.getElementById(targetSelectId);
                editSelect.innerHTML = uniqueCategories.map(cat => 
                    `<option value="${cat}" ${cat === selectedCategory ? 'selected' : ''}>${cat}</option>`
                ).join('');
            }
            
            // Popula o select de Filtro (com contagem)
            const categoriesWithCount = getUniqueCategoriesWithCount();
            const currentFilter = filterSelect.value;

            filterSelect.innerHTML = `<option value="all">Todas as Categorias (${links.length})</option>`;
            
            categoriesWithCount.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = `${cat.name} (${cat.count})`;
                if (cat.name === currentFilter) {
                    option.selected = true;
                }
                if (cat.name !== 'Sem Categoria') {
                    filterSelect.appendChild(option);
                }
            });
        }
        
        // --- GERENCIAMENTO DE CATEGORIAS (MODAL) ---
        
        function openCategoryModal() {
            document.getElementById('categoryModal').classList.add('active');
            renderCategoryList();
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
            renderLinks(); 
        }

        function renderCategoryList() {
            const categoryList = document.getElementById('categoryList');
            const categoriesWithCount = getUniqueCategoriesWithCount().filter(cat => cat.name !== 'Sem Categoria');
            
            categoryList.innerHTML = categoriesWithCount.map(cat => {
                return `
                    <div class="category-item" data-category="${cat.name}">
                        <span id="categoryName-${cat.name.replace(/\s/g, '_')}">${cat.name} (${cat.count} links)</span>
                        <input type="text" id="editInput-${cat.name.replace(/\s/g, '_')}" value="${cat.name}" style="display: none;">
                        <div class="category-actions">
                            <button class="icon-btn" onclick="toggleEditCategoryName('${cat.name}')" title="Renomear">‚úèÔ∏è</button>
                            <button class="icon-btn delete-btn" onclick="deleteCategory('${cat.name}')" title="Excluir">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('') || '<p style="text-align: center; color: #999;">Nenhuma categoria personalizada.</p>';
        }

        function addCategory() {
            const newName = document.getElementById('newCategoryName').value.trim();
            if (!newName) {
                alert("Por favor, insira um nome para a nova categoria.");
                return;
            }
            // Verifica se a categoria j√° existe (case-insensitive)
            if (getUniqueCategories().map(c => c.toLowerCase()).includes(newName.toLowerCase())) {
                alert("Essa categoria j√° existe!");
                return;
            }

            // Para garantir que a nova categoria apare√ßa nos selects,
            // for√ßamos o re-render dos selects e fechamos o modal.
            // O usu√°rio pode ent√£o us√°-la.
            
            // No caso de n√£o ter nenhum link, ele n√£o ir√° aparecer.
            // Vamos apenas for√ßar a atualiza√ß√£o dos selects:
            
            // Atualiza o DOM e fecha o modal. O usu√°rio adicionar√° o primeiro link
            // com a nova categoria no formul√°rio.
            document.getElementById('newCategoryName').value = '';
            populateCategorySelects();
            alert(`Categoria "${newName}" pode ser usada agora! Adicione o primeiro link com essa categoria.`);
            closeCategoryModal(); 
        }

        function toggleEditCategoryName(oldName) {
            // ... (Fun√ß√µes de renomear e excluir categoria permanecem iguais,
            // apenas garantindo que chamam renderLinks() no final)
            const safeOldName = oldName.replace(/\s/g, '_');
            const span = document.getElementById(`categoryName-${safeOldName}`);
            const input = document.getElementById(`editInput-${safeOldName}`);
            
            if (span.style.display !== 'none') {
                span.style.display = 'none';
                input.style.display = 'inline-block';
                input.focus();
                input.onblur = () => saveCategoryName(oldName, input.value.trim());
                input.onkeypress = (e) => {
                    if (e.key === 'Enter') saveCategoryName(oldName, input.value.trim());
                };
            } else {
                saveCategoryName(oldName, input.value.trim());
            }
        }

        function saveCategoryName(oldName, newName) {
            const safeOldName = oldName.replace(/\s/g, '_');
            const span = document.getElementById(`categoryName-${safeOldName}`);
            const input = document.getElementById(`editInput-${safeOldName}`);
            
            if (!newName || newName === oldName) {
                span.style.display = 'inline-block';
                input.style.display = 'none';
                renderCategoryList();
                return;
            }
            
            if (getUniqueCategories().map(c => c.toLowerCase()).includes(newName.toLowerCase())) {
                alert("Essa categoria j√° existe!");
                renderCategoryList();
                return;
            }

            links.forEach(link => {
                if (link.category === oldName) {
                    link.category = newName;
                }
            });

            saveLinks();
            renderCategoryList();
            renderLinks(); 
        }

        function deleteCategory(categoryToDelete) {
            if (categoryToDelete === 'Sem Categoria') return;
            
            if (confirm(`Tem certeza que deseja excluir a categoria "${categoryToDelete}"? Todos os links ser√£o movidos para "Sem Categoria".`)) {
                
                links.forEach(link => {
                    if (link.category === categoryToDelete) {
                        link.category = 'Sem Categoria';
                    }
                });

                saveLinks();
                renderCategoryList();
                renderLinks(); 
            }
        }

        // --- FUN√á√ïES DE EDI√á√ÉO COMPLETA (NOVO) ---
        
        function openEditModal(index) {
            const link = links[index];

            document.getElementById('editLinkIndex').value = index;
            document.getElementById('editLinkUrl').value = link.url;
            document.getElementById('editLinkTitle').value = link.title;
            document.getElementById('editLinkDescription').value = link.description;

            // Popula o select do modal de edi√ß√£o com a categoria correta selecionada
            populateCategorySelects('editLinkCategory', link.category);
            
            document.getElementById('editLinkModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editLinkModal').classList.remove('active');
        }

        function validateAndCleanURL(url) {
            if (!url.match(/^https?:\/\//i)) {
                url = 'https://' + url;
            }
            try {
                new URL(url);
                return url;
            } catch (e) {
                return null;
            }
        }

        function saveEditedLink() {
            const index = parseInt(document.getElementById('editLinkIndex').value);
            let newUrl = document.getElementById('editLinkUrl').value.trim();
            const newTitle = document.getElementById('editLinkTitle').value.trim();
            const newCategory = document.getElementById('editLinkCategory').value;
            const newDescription = document.getElementById('editLinkDescription').value.trim();

            if (!newUrl || !newTitle) {
                alert('URL e T√≠tulo s√£o obrigat√≥rios.');
                return;
            }

            newUrl = validateAndCleanURL(newUrl);

            if (!newUrl) {
                alert('A URL fornecida n√£o √© v√°lida. Por favor, corrija o formato.');
                return;
            }

            links[index].url = newUrl;
            links[index].title = newTitle;
            links[index].category = newCategory;
            links[index].description = newDescription;

            saveLinks();
            renderLinks();
            closeEditModal();
        }

        // --- FUN√á√ÉO DE ADICIONAR LINK (Com Valida√ß√£o de URL) ---

        function addLink() {
            let url = document.getElementById('linkUrl').value.trim();
            const title = document.getElementById('linkTitle').value.trim();
            const description = document.getElementById('linkDescription').value.trim();
            const category = document.getElementById('linkCategory').value;

            if (!url || !title) {
                alert('Por favor, preencha a URL e o t√≠tulo do link!');
                return;
            }
            
            url = validateAndCleanURL(url);

            if (!url) {
                alert('A URL fornecida n√£o √© v√°lida. Por favor, corrija o formato.');
                return;
            }


            links.push({
                url: url,
                title: title,
                description: description,
                notes: '',
                favorite: false,
                category: category,
                editingTitle: false,
                editingDescription: false,
                editingCategory: false
            });

            document.getElementById('linkUrl').value = '';
            document.getElementById('linkTitle').value = '';
            document.getElementById('linkDescription').value = '';
            
            saveLinks();
            renderLinks();
        }
        
        // --- FUN√á√ïES DE RENDERIZA√á√ÉO E FILTRO (CORRIGIDO) ---

        function renderLinks() {
            const linksList = document.getElementById('linksList');
            const searchValue = document.getElementById('searchInput').value.toLowerCase().trim();
            const filterCategory = document.getElementById('filterCategory').value;

            populateCategorySelects();

            let filteredLinks = links.filter(link => {
                const searchString = `${link.title} ${link.url} ${link.description} ${link.notes} ${link.category}`.toLowerCase();
                const matchesSearch = searchValue === '' || searchString.includes(searchValue);
                const matchesCategory = filterCategory === 'all' || link.category === filterCategory;
                return matchesSearch && matchesCategory;
            });

            if (filteredLinks.length === 0) {
                 linksList.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                        </svg>
                        <h3>${searchValue || filterCategory !== 'all' ? 'Nenhum link encontrado com os filtros atuais' : 'Nenhum link salvo ainda'}</h3>
                        <p>${searchValue || filterCategory !== 'all' ? 'Tente ajustar sua pesquisa ou filtro' : 'Adicione seu primeiro link usando o formul√°rio acima'}</p>
                    </div>
                `;
                initializeSortable();
                return;
            }

            linksList.innerHTML = filteredLinks.map((link) => {
                const originalIndex = links.indexOf(link); 
                const linkNumber = `${originalIndex + 1}. `; 
                
                const categoryOptions = getUniqueCategories().map(cat => 
                    `<option value="${cat}" ${link.category === cat ? 'selected' : ''}>${cat}</option>`
                ).join('');

                return `
                    <div class="link-item ${link.favorite ? 'favorite' : ''}" data-id="${originalIndex}">
                        <div class="link-header">
                            ${link.editingTitle ? 
                                `<input type="text" class="title-input" value="${link.title}" onblur="saveTitle(${originalIndex}, this.value)" onkeypress="if(event.key==='Enter') saveTitle(${originalIndex}, this.value)" autofocus>` :
                                `<a href="${link.url}" target="_blank" class="link-title">${linkNumber}${link.title} 
                                    ${link.editingCategory ?
                                        `<select class="category-select-inline" onblur="saveCategory(${originalIndex}, this.value)" onchange="saveCategory(${originalIndex}, this.value)">
                                            ${categoryOptions}
                                        </select>` :
                                        `<span class="link-category">${link.category}
                                            <button class="icon-btn" onclick="toggleEditCategory(${originalIndex})" title="Editar Categoria">‚úèÔ∏è</button>
                                        </span>`
                                    }
                                </a>`
                            }
                            <div class="link-actions">
                                <button class="icon-btn edit-btn" onclick="openEditModal(${originalIndex})" title="Editar Link Completo">
                                    üìù
                                </button>
                                <button class="icon-btn favorite-btn" onclick="toggleFavorite(${originalIndex})" title="Favoritar">
                                    ${link.favorite ? '‚≠ê' : '‚òÜ'}
                                </button>
                                <button class="icon-btn move-btn" onclick="openMoveModal(${originalIndex})" title="Mover">
                                    ‚ÜïÔ∏è
                                </button>
                                <button class="icon-btn delete-btn" onclick="deleteLink(${originalIndex})" title="Excluir">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                        <div class="link-url">${link.url}</div>
                        ${link.editingDescription ? 
                            `<textarea class="description-input" onblur="saveDescription(${originalIndex}, this.value)" onkeypress="if(event.key==='Enter') saveDescription(${originalIndex}, this.value)">${link.description || ''}</textarea>
                            <button class="icon-btn edit-btn" onclick="toggleEditDescription(${originalIndex})" title="Salvar Descri√ß√£o" style="position: absolute; right: 25px; bottom: 85px;">‚úì</button>` :
                            `<div class="link-description description-text" onclick="toggleEditDescription(${originalIndex})" title="Clique para editar">${link.description || 'Sem descri√ß√£o (clique para adicionar)'}</div>`
                        }
                        
                        <textarea class="link-notes" placeholder="Adicione notas aqui..." oninput="updateNotes(${originalIndex}, this.value)">${link.notes || ''}</textarea>
                    </div>
                `;
            }).join('');
            
            initializeSortable();
        }

        // --- FUN√á√ïES DE EDI√á√ÉO IN-LINE, ORDENA√á√ÉO E MODAIS (Restante) ---
        // (As fun√ß√µes de edi√ß√£o in-line e modais de mover/backup permanecem inalteradas,
        // mas a `renderLinks` agora usa o novo bot√£o üìù)

        function sortLinks(type) {
            if (type === 'title') {
                sortDirection = sortDirection * -1; 
                links.sort((a, b) => a.title.localeCompare(b.title) * sortDirection);
            } else if (type === 'favorite') {
                links.sort((a, b) => {
                    if (a.favorite && !b.favorite) return -1;
                    if (!a.favorite && b.favorite) return 1;
                    return 0; 
                });
            }
            saveLinks();
            renderLinks();
        }

        function initializeSortable() {
            const list = document.getElementById('linksList');
            const isFiltered = document.getElementById('searchInput').value.trim() !== '' || document.getElementById('filterCategory').value !== 'all';

            if (list.sortable) {
                list.sortable.destroy();
            }

            if (isFiltered) {
                list.style.cursor = 'default';
                return; 
            }
            
            list.style.cursor = 'grab';
            list.sortable = Sortable.create(list, {
                animation: 150,
                filter: '.title-input, .description-input, .category-select-inline, .link-notes',
                onEnd: function (evt) {
                    const oldIndex = evt.oldIndex;
                    const newIndex = evt.newIndex;
                    
                    const itemToMove = links.splice(oldIndex, 1)[0];
                    links.splice(newIndex, 0, itemToMove);
                    
                    saveLinks();
                    renderLinks();
                },
            });
        }
        
        function toggleFavorite(index) {
            links[index].favorite = !links[index].favorite;
            saveLinks();
            renderLinks();
        }

        function toggleEditTitle(index) {
            links.forEach((link, i) => {
                if (i !== index) link.editingTitle = false;
                link.editingDescription = false; 
                link.editingCategory = false; 
            });
            links[index].editingTitle = !links[index].editingTitle;
            renderLinks();
        }

        function saveTitle(index, newTitle) {
            if (newTitle.trim()) {
                links[index].title = newTitle.trim();
            }
            links[index].editingTitle = false;
            saveLinks();
            renderLinks();
        }

        function toggleEditDescription(index) {
             links.forEach((link, i) => {
                if (i !== index) link.editingDescription = false;
                link.editingTitle = false;
                link.editingCategory = false;
            });
            links[index].editingDescription = !links[index].editingDescription;
            renderLinks();
        }

        function saveDescription(index, newDescription) {
            links[index].description = newDescription.trim();
            links[index].editingDescription = false;
            saveLinks();
            renderLinks();
        }

        function toggleEditCategory(index) {
             links.forEach((link, i) => {
                if (i !== index) link.editingCategory = false;
                link.editingTitle = false;
                link.editingDescription = false;
            });
            links[index].editingCategory = !links[index].editingCategory;
            renderLinks();
        }

        function saveCategory(index, newCategory) {
            links[index].category = newCategory;
            links[index].editingCategory = false;
            saveLinks();
            renderLinks();
        }

        function updateNotes(index, value) {
            links[index].notes = value;
            saveLinks();
        }

        function deleteLink(index) {
            if (confirm('Tem certeza que deseja excluir este link?')) {
                links.splice(index, 1);
                saveLinks();
                renderLinks();
            }
        }

        function openMoveModal(index) {
            currentMoveIndex = index;
            document.getElementById('maxPosition').textContent = links.length;
            document.getElementById('targetPosition').setAttribute('max', links.length);
            document.getElementById('targetPosition').value = index + 1;
            document.getElementById('moveModal').classList.add('active');
        }

        function closeMoveModal() {
            document.getElementById('moveModal').classList.remove('active');
            currentMoveIndex = null;
        }

        function moveToPosition(position) {
            if (currentMoveIndex === null) return;

            const link = links.splice(currentMoveIndex, 1)[0];
            
            if (position === 'first') {
                links.unshift(link);
            } else if (position === 'last') {
                links.push(link);
            }

            saveLinks();
            renderLinks();
            closeMoveModal();
        }

        function moveLinkToSpecificPosition() {
            if (currentMoveIndex === null) return;
            
            const targetPositionInput = document.getElementById('targetPosition');
            let targetPosition = parseInt(targetPositionInput.value); 
            let targetIndex = targetPosition - 1; 
            
            if (isNaN(targetPosition) || targetPosition < 1 || targetPosition > links.length) {
                alert(`Por favor, insira uma linha v√°lida entre 1 e ${links.length}.`);
                return;
            }

            const link = links.splice(currentMoveIndex, 1)[0];
            links.splice(targetIndex, 0, link);

            saveLinks();
            renderLinks();
            closeMoveModal();
        }

        function exportLinks() {
            const dataStr = JSON.stringify(links, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'links_backup.json';

            let linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function importLinks() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert("Por favor, selecione um arquivo JSON para importar.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedLinks = JSON.parse(e.target.result);
                    if (Array.isArray(importedLinks)) {
                        if (confirm(`Tem certeza que deseja substituir os ${links.length} links atuais por ${importedLinks.length} links importados?`)) {
                            links = importedLinks.map(link => ({ 
                                ...link, 
                                category: link.category || 'Sem Categoria',
                                editingTitle: false,
                                editingDescription: false,
                                editingCategory: false
                            }));
                            saveLinks();
                            renderLinks();
                            alert("Importa√ß√£o conclu√≠da com sucesso!");
                        }
                    } else {
                        alert("Formato de arquivo JSON inv√°lido. O arquivo deve conter uma lista (array) de links.");
                    }
                } catch (error) {
                    alert("Erro ao ler o arquivo JSON. Verifique se o formato est√° correto.");
                    console.error("Erro de importa√ß√£o:", error);
                }
            };
            reader.readAsText(file);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            loadDarkModePreference();
            updatePageTitleCount();
            renderLinks();
        });
    </script>
</body>
</html>
